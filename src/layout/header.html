<header class="header">
    
    <div class="header_center">

        <div class="header_left">
            <a href="./index.html" class="logo_img">
                <img src="./images/logo_red.png" alt="" class="logo_img-inner -real">
                <img src="./images/logo_gold.png" alt="" class="logo_img-inner -hover">
            </a>
        
            <nav class="nav">
                <ul class="link_list">
                    <li><a href="./aboutus.html">關於Cupid</a></li>
                    <li><a href="./cards.html">我的喜帖</a></li>
                    <li><a href="./gift.html">婚禮小物</a></li>
                    <li><a href="./faq.html">常見問題</a></li>
                </ul>
            </nav>     
        </div>
    
    
        <div class="header_right">
            <a href="./member.html">
                <svg class="member" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M12 12C14.7623 12 17 9.76228 17 7C17 4.23772 14.7623 2 12 2C9.23772 2 7 4.23772 7 7C7 9.76228 9.23772 12 12 12ZM12 4C13.6577 4 15 5.34228 15 7C15 8.65772 13.6577 10 12 10C10.3423 10 9 8.65772 9 7C9 5.34228 10.3423 4 12 4ZM21 21C21 21.5523 20.5523 22 20 22C19.4477 22 19 21.5523 19 21V19C19 17.5399 15.156 16 12 16C8.844 16 5 17.5399 5 19V21C5 21.5523 4.55228 22 4 22C3.44772 22 3 21.5523 3 21V19C3 15.9353 7.83098 14 12 14C16.169 14 21 15.9353 21 19V21Z"
                        fill="#C2D1D9" />
                    <mask id="mask0_808_12140" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="3" y="2" width="18"
                        height="20">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M12 12C14.7623 12 17 9.76228 17 7C17 4.23772 14.7623 2 12 2C9.23772 2 7 4.23772 7 7C7 9.76228 9.23772 12 12 12ZM12 4C13.6577 4 15 5.34228 15 7C15 8.65772 13.6577 10 12 10C10.3423 10 9 8.65772 9 7C9 5.34228 10.3423 4 12 4ZM21 21C21 21.5523 20.5523 22 20 22C19.4477 22 19 21.5523 19 21V19C19 17.5399 15.156 16 12 16C8.844 16 5 17.5399 5 19V21C5 21.5523 4.55228 22 4 22C3.44772 22 3 21.5523 3 21V19C3 15.9353 7.83098 14 12 14C16.169 14 21 15.9353 21 19V21Z"
                            fill="white" />
                    </mask>
                    <g mask="url(#mask0_808_12140)">
                        <rect width="24" height="24" fill="currentColor" />
                    </g>
                </svg>
                <p>會員中心</p>
            </a>

            <a class="float_right" id="btn" onclick="disableScroll()"><svg width="24" height="24" viewBox="0 0 24 24"
                fill="none" xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_2496_11740" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24"
                    height="23">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M1 0C0.447715 0 0 0.447715 0 1C0 1.55228 0.447715 2 1 2H4.18032L5.01195 6.15508C5.01638 6.18353 5.02201 6.21159 5.02879 6.2392L6.69916 14.5848L6.69933 14.5857C6.83664 15.2759 7.21225 15.8959 7.76048 16.3373C8.3062 16.7766 8.98837 17.011 9.68864 17H19.3914C20.0916 17.011 20.7738 16.7766 21.3195 16.3373C21.868 15.8958 22.2437 15.2754 22.3808 14.5848L22.3809 14.5848L22.3823 14.5773L23.9823 6.18733C24.0381 5.89458 23.9605 5.59218 23.7705 5.36256C23.5805 5.13293 23.298 5 23 5H6.82043L5.98055 0.803743C5.88701 0.336385 5.47663 0 5 0H1ZM8.66055 14.1937L7.22073 7H21.7913L20.4185 14.1984C20.3723 14.4273 20.2474 14.6328 20.0654 14.7793C19.8826 14.9265 19.6538 15.0047 19.4192 15.0002L19.4 15H9.68L9.66084 15.0002C9.42619 15.0047 9.19743 14.9265 9.01461 14.7793C8.83179 14.6322 8.70656 14.4254 8.66084 14.1952L8.66055 14.1937ZM7 21C7 19.8954 7.89543 19 9 19C10.1046 19 11 19.8954 11 21C11 22.1046 10.1046 23 9 23C7.89543 23 7 22.1046 7 21ZM18 21C18 19.8954 18.8954 19 20 19C21.1046 19 22 19.8954 22 21C22 22.1046 21.1046 23 20 23C18.8954 23 18 22.1046 18 21Z"
                        fill="white" />
                </mask>
                <g mask="url(#mask0_2496_11740)">
                    <rect width="24" height="24" fill="currentColor" />
                </g>
            </svg>
            <p>購物車</p>
            </a>

        </div>

        <div class="header_right_aside">
            <a href="./member.html">
                <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <mask id="mask0_2559_11726" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="22" height="24">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10.8 12C14.1147 12 16.8 9.31474 16.8 6C16.8 2.68526 14.1147 0 10.8 0C7.48526 0 4.8 2.68526 4.8 6C4.8 9.31474 7.48526 12 10.8 12ZM10.8 2.4C12.7892 2.4 14.4 4.01074 14.4 6C14.4 7.98926 12.7892 9.6 10.8 9.6C8.81069 9.6 7.19995 7.98926 7.19995 6C7.19995 4.01074 8.81069 2.4 10.8 2.4ZM21.6 22.8C21.6 23.4627 21.0627 24 20.4 24C19.7373 24 19.2 23.4627 19.2 22.8V20.4C19.2 18.6479 14.5872 16.8 10.8 16.8C7.0128 16.8 2.4 18.6479 2.4 20.4C2.4 20.4004 2.4 20.4007 2.4 20.4011V22.8C2.4 23.4627 1.86274 24 1.2 24C0.537258 24 0 23.4627 0 22.8V20.4C0 16.7223 5.79718 14.4 10.8 14.4C15.8028 14.4 21.6 16.7223 21.6 20.4V22.8Z" fill="#932639"/>
                    </mask>
                    <g mask="url(#mask0_2559_11726)">
                    <path d="M-1 0H23V24H-1V0Z" fill="currentColor"/>
                    </g>
                </svg>
            </a>

            <a href="./cart.html" id="btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>       
            </a>  

            <!-- 漢堡選單icon -->
            <div class="burger">
                <button class="hamburger hamburger--collapse" type="button">
                    <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                    </span>
                </button>        
            </div>
        </div>
    

        

        <!-- 側邊選單 -->
        <aside class="menu_aside">
            <nav class="menu_aside_nav">
                <ul class="menu_aside_nav_list">
                    <li><a class="-on" href="./aboutus.html">關於Cupid</a></li>
                    <li><a href="./cards.html">我的喜帖</a></li>
                    <li><a href="./gift.html">婚禮小物</a></li>
                    <li><a href="./faq.html">常見問題</a></li>           
                </ul>
            </nav> 
        </aside>
        <div class="aside_bg"></div>
        

    </div>
</header>


<!-- //購物車 -->
<div class="cart_mask" style="display:none"></div>
<div class="asideCart ">
    <div class="title">
        <div class="text">購物清單</div>
        <img src="./images/icons/close.svg" alt="" id="close" onclick="enableScroll()">
    </div>

    <div class="bottom" id="content">
        <div class="total">
            <p>數量</p>
            <p> <span id="itemCount">0</span>件</p>
        </div>
        <div class="total" style="color: red;">
            <p>小計</p>
            <p> <span id="totalPrice">0</span>元</p>
        </div>
    </div>
    <a href="./shopping_process01.html"> <button>前往結帳</button></a>

</div>

<script>

    /* ========== 漢堡選單切換 ========== */
    $("button.hamburger.hamburger--collapse").on("click", function(){
        $("aside.menu_aside").toggleClass("-open");
        $("div.aside_bg").toggleClass("-open");
        $("button.hamburger.hamburger--collapse").toggleClass("is-active");
    });



    /* ========== 購物車 ========== */
    $(function () {
        $("#btn").click(function () {
            $(".asideCart").addClass("active");
            $(".cart_mask").removeAttr("style")

        });
        $("#close").click(function () {
            $(".asideCart").removeClass("active");
            $(".cart_mask").css({ "display": "none" })
        });

        $(".cart_mask").click(function () {
            $(".asideCart").removeClass("active");
            $(".cart_mask").css({ "display": "none" })
        });

    });


    $(function () {
        var t = $("#quantity");
        $("#add").click(function () {
            t.val(parseInt(t.val()) + 1);
            $("#min").removeAttr("disabled");                 //當按加1時，解除$("#min")不可讀狀態
            setTotal();
        })
        $("#min").click(function () {
            if (parseInt(t.val()) > 1) {                     //判斷數量值大於1時才可以減少
                t.val(parseInt(t.val()) - 1)
            } else {
                $("#min").attr("disabled", "disabled")        //當$("#min")為1時，$("#min")不可讀狀態
            }
            setTotal();
        })
        function setTotal() {
            $("#total").html((parseInt(t.val()) * 3.95).toFixed(2));
        }
        setTotal();
    })

    //鎖住垂直卷軸
    function disableScroll() {
        // Get the current page scroll position
        scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;
        scrollLeft =
            window.pageXOffset || document.documentElement.scrollLeft,

            // if any scroll is attempted,
            // set this to the previous value
            window.onscroll = function () {
                window.scrollTo(scrollLeft, scrollTop);
            };
    }

    //打開垂直卷軸
    function enableScroll() {
        window.onscroll = function () { };
    }



    //購物車
    let storage = localStorage;
    function doFirst() {
        let itemString = storage['addItemList'];
        // 幫每個 Add Cart 建立事件聆聽
        let list = document.querySelectorAll('.addButton');  //list 是陣列
        console.log(list);
        for (let i = 0; i < list.length; i++) {
            list[i].addEventListener('click', function (e) {
                // alert(e.target.id)
                //alert(this.id)//都行
                // let teddyInfo = document.querySelector(`#A1001 input`).value;//空格代表子孫選則器
                // let teddyInfo = document.querySelector(`#A1001>input`).value;
                let teddyInfo = document.querySelector(`#${this.id}>input`).value;
                console.log(teddyInfo);
                console.log(this.id);
                addItem(this.id, teddyInfo);
            });
        }


        if (!itemString) {
            return false;
        }

        console.log(itemString);
        let items = itemString.substr(0, itemString.length - 2).split(', ');
        if (storage['addItemList'] == null) {
            storage['addItemList'] = '';   // storage.setItem('addItemList','');
        }

        newDiv = document.createElement('div');
        newDiv.className = 'cart_div';
        newTable = document.createElement('div');
        newTable.className = 'cart_list';
        // 將 table 放進 div, 再將 div 放進 cartList 中
        newDiv.appendChild(newTable);
        document.getElementById('asideCart').appendChild(newDiv);

        totalPrice = 0;
        // 每購買一個品項就呼叫 createCartList 函數新增一個 <tr>
        for (let i = 0; i < items.length; i++) {
            let itemInfo = storage.getItem(items[i]);
            totalPrice += parseInt(itemInfo.split('|')[2]);
            createCartList(items[i], itemInfo);
        }

        document.getElementById('itemCount').innerText = items.length;
        document.getElementById('totalPrice').innerText = totalPrice;

    }

    function createCartList(itemId, itemValue) {
        let itemTitle = itemValue.split('|')[0];
        let itemImage = './images/' + itemValue.split('|')[1];
        let itemPrice = parseInt(itemValue.split('|')[2]);

        let trItemList = document.createElement('ul');
        trItemList.className = 'item';
        newTable.appendChild(trItemList);

        let newItem = document.createElement('li');
        newItem.id = 'newItem';
        trItemList.appendChild(newItem);

        let liImage = document.createElement('img');
        liImage.src = itemImage;
        newItem.appendChild(liImage);

        let liText = document.createElement('div');
        liText.className = 'text';
        newItem.appendChild(liText);

        let liName = document.createElement('div');
        liName.className = 'name';
        liText.appendChild(liName);
        liName.innerText = itemTitle;

        let PlusLower = document.createElement('div');
        PlusLower.className = 'PlusLower';
        liText.appendChild(PlusLower);

        let min = document.createElement('input');
        min.id = 'min';
        min.type = 'button';
        min.value = '-';
        PlusLower.appendChild(min);

        let quantity = document.createElement('input');
        quantity.id = 'quantity';
        quantity.type = 'text';
        quantity.value = '1';
        PlusLower.appendChild(quantity);

        let add = document.createElement('input');
        add.id = 'add';
        add.type = 'button';
        add.value = '+';
        PlusLower.appendChild(add);

        let price = document.createElement('div');
        price.className = 'price';
        price.style.color = 'red';
        liText.appendChild(price);
        price.innerText = 'NT$' + itemPrice;


        let itemdelete = document.createElement('div');
        itemdelete.className = 'itemdelete';
        newItem.appendChild(itemdelete);

        let deleteimg = document.createElement('img');
        deleteimg.className = 'delete';
        deleteimg.src = "./images/icons/trash_can.svg";
        itemdelete.appendChild(deleteimg);

        let itemhr = document.createElement('hr');
        trItemList.appendChild(itemhr);
    }


    function addItem(itemId, itemValue) {

        // 存入 storage
        if (storage[itemId]) {         //如果有東西
            alert('此產品已在購物車');
        } else {

            if (storage['addItemList']) {
                storage['addItemList'] += `${itemId}, `;
            } else {
                storage.setItem('addItemList', `${itemId}, `);
            }
            storage.setItem(itemId, itemValue);
            //////
            let itemTitle = itemValue.split('|')[0];
            let itemImage = './images/' + itemValue.split('|')[1];
            let itemPrice = parseInt(itemValue.split('|')[2]);

            let trItemList = document.createElement('ul');
            trItemList.className = 'item';
            newTable.appendChild(trItemList);

            let newItem = document.createElement('li');
            newItem.id = 'newItem';
            trItemList.appendChild(newItem);

            let liImage = document.createElement('img');
            liImage.src = itemImage;
            newItem.appendChild(liImage);

            let liText = document.createElement('div');
            liText.className = 'text';
            newItem.appendChild(liText);

            let liName = document.createElement('div');
            liName.className = 'name';
            liText.appendChild(liName);
            liName.innerText = itemTitle;

            let PlusLower = document.createElement('div');
            PlusLower.className = 'PlusLower';
            liText.appendChild(PlusLower);

            let min = document.createElement('input');
            min.id = 'min';
            min.type = 'button';
            min.value = '-';
            PlusLower.appendChild(min);

            let quantity = document.createElement('input');
            quantity.id = 'quantity';
            quantity.type = 'text';
            quantity.value = '1';
            PlusLower.appendChild(quantity);

            let add = document.createElement('input');
            add.id = 'add';
            add.type = 'button';
            add.value = '+';
            PlusLower.appendChild(add);

            let price = document.createElement('div');
            price.className = 'price';
            price.style.color = 'red';
            liText.appendChild(price);
            price.innerText = 'NT$' + itemPrice;


            let itemdelete = document.createElement('div');
            itemdelete.className = 'itemdelete';
            newItem.appendChild(itemdelete);

            let deleteimg = document.createElement('img');
            deleteimg.className = 'delete';
            deleteimg.src = "./images/icons/trash_can.svg";
            itemdelete.appendChild(deleteimg);

            let itemhr = document.createElement('hr');
            trItemList.appendChild(itemhr);

            let itemString = storage['addItemList'];
            let list = document.querySelectorAll('.addButton');  //list 是陣列

            let items = itemString.substr(0, itemString.length - 2).split(', ');
            if (storage['addItemList'] == null) {
                storage['addItemList'] = '';   // storage.setItem('addItemList','');
            }

            totalPrice = 0;
            // 每購買一個品項就呼叫 createCartList 函數新增一個 <tr>
            for (let i = 0; i < items.length; i++) {
                let itemInfo = storage.getItem(items[i]);
                totalPrice += parseInt(itemInfo.split('|')[2]);
                // createCartList(items[i], itemInfo);
            }

            document.getElementById('itemCount').innerText = items.length;
            document.getElementById('totalPrice').innerText = totalPrice;
            ////////
        }

    }

    function deleteItem(e) {
        let itemId = e.target.parentNode.id;

        // 1.扣除總金額 -- 若要完成作業，也要修改此處
        let itemValue = storage.getItem(itemId);
        total -= parseInt(itemValue.split('|')[2]);
        document.getElementById('total').innerText = total;

        // 2.清除storage
        storage.removeItem(itemId)
        storage['addItemList'] = storage['addItemList'].replace(`${itemId}, `, ``);

        // 3.刪除該筆 <tr>
        // this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);
        newTable.removeChild(this.parentNode.parentNode);
    }


    window.addEventListener('load', doFirst);


</script>